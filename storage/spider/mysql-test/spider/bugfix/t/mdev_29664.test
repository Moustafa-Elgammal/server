--source include/have_innodb.inc

--echo #
--echo # MDEV-29664 Assertion `!n_mysql_tables_in_use' failed in innobase_close_connection
--echo #

--disable_query_log
--disable_result_log
--source ../../t/test_init.inc
--enable_result_log
--enable_query_log

--connection master_1
create database auto_test_local;
use auto_test_local;
set spider_same_server_link= on;

create table t (c int) engine=innodb;
eval create table t1 (c1 text) $MASTER_1_ENGINE $MASTER_1_CHARSET
comment='wrapper "mysql", srv "s_1", table "t"';
--error ER_BAD_FIELD_ERROR
create or replace table t2 engine=innodb
as select format (c1,0) as c1 from t1;

drop database auto_test_local;

--disable_query_log
--disable_result_log
--source ../../t/test_deinit.inc
--enable_result_log
--enable_query_log
